# ğŸ”’ Semgrep å®‰å…¨å•é¡Œè‡ªå‹•ä¿®å¾©å·¥å…·

é€™å€‹å·¥å…·é›†å¯ä»¥è‡ªå‹•ä¿®å¾© Semgrep æƒæç™¼ç¾çš„å¸¸è¦‹å®‰å…¨å•é¡Œï¼ŒåŒ…æ‹¬ Nginx é…ç½®ã€Dockerfile å’Œ Terraform ç›¸é—œçš„å®‰å…¨æ¼æ´ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹è‰²

- ğŸ” **è‡ªå‹•æƒæ**: ä½¿ç”¨ Semgrep è‡ªå‹•æª¢æ¸¬å®‰å…¨å•é¡Œ
- ğŸ”§ **æ™ºèƒ½ä¿®å¾©**: è‡ªå‹•ä¿®å¾©å¸¸è¦‹çš„å®‰å…¨é…ç½®å•é¡Œ
- ğŸ“„ **è©³ç´°å ±å‘Š**: ç”Ÿæˆå®Œæ•´çš„ä¿®å¾©å ±å‘Š
- ğŸ”„ **å‚™ä»½ä¿è­·**: è‡ªå‹•å‚™ä»½åŸå§‹æª”æ¡ˆ
- âœ… **é©—è­‰æ©Ÿåˆ¶**: ä¿®å¾©å¾Œè‡ªå‹•é©—è­‰æ•ˆæœ

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´

```bash
# å®‰è£ Semgrep å’Œç›¸é—œå·¥å…·
make -f Makefile.security security-install

# æˆ–è€…æ‰‹å‹•å®‰è£
pip install semgrep pyyaml requests
```

### 2. åŸ·è¡Œå®Œæ•´ä¿®å¾©æµç¨‹

```bash
# åŸ·è¡Œå®Œæ•´çš„å®‰å…¨ä¿®å¾©æµç¨‹
make -f Makefile.security security-full
```

### 3. åˆ†æ­¥é©ŸåŸ·è¡Œ

```bash
# 1. åŸ·è¡Œå®‰å…¨æƒæ
make -f Makefile.security security-scan

# 2. æŸ¥çœ‹å•é¡Œæ‘˜è¦
make -f Makefile.security security-summary

# 3. è‡ªå‹•ä¿®å¾©å•é¡Œ
make -f Makefile.security security-fix

# 4. é©—è­‰ä¿®å¾©æ•ˆæœ
make -f Makefile.security security-verify

# 5. æŸ¥çœ‹ä¿®å¾©å ±å‘Š
make -f Makefile.security security-report
```

## ğŸ”§ æ”¯æ´ä¿®å¾©çš„å•é¡Œé¡å‹

### Nginx é…ç½®å•é¡Œ
- âœ… **ç¼ºå°‘ `always` æ¨™èªŒ**: ä¿®å¾© `add_header` æŒ‡ä»¤ç¼ºå°‘ `always` æ¨™èªŒ
- âœ… **H2C èµ°ç§æ¼æ´**: é™åˆ¶ Upgrade æ¨™é ­ä»¥é˜²æ­¢ HTTP/2 over cleartext èµ°ç§

### Dockerfile å®‰å…¨å•é¡Œ
- âœ… **ç¼ºå°‘é root ç”¨æˆ¶**: è‡ªå‹•æ·»åŠ é root ç”¨æˆ¶ä»¥æå‡å®¹å™¨å®‰å…¨æ€§

### Terraform å®‰å…¨å•é¡Œ
- âœ… **ELB ç¼ºå°‘æ—¥èªŒ**: å•Ÿç”¨ Application Load Balancer å­˜å–æ—¥èªŒ
- âœ… **ä¸å®‰å…¨çš„ TLS ç‰ˆæœ¬**: å‡ç´šåˆ°å®‰å…¨çš„ TLS 1.3 ç‰ˆæœ¬
- âœ… **CloudWatch æ—¥èªŒæœªåŠ å¯†**: æ·»åŠ  KMS åŠ å¯†é…ç½®
- âœ… **KMS ç¼ºå°‘è¼ªæ›**: å•Ÿç”¨é‡‘é‘°è‡ªå‹•è¼ªæ›
- âœ… **å­ç¶²è·¯å…¬å…± IP åœ°å€**: ä¿®å¾©å­ç¶²è·¯è‡ªå‹•åˆ†é…å…¬å…± IP çš„å•é¡Œ

## ğŸ“ æª”æ¡ˆçµæ§‹

```
.
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ security-auto-fix.yml    # GitHub Actions è‡ªå‹•ä¿®å¾©å·¥ä½œæµç¨‹
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ security_auto_fix.py    # Python è‡ªå‹•ä¿®å¾©è…³æœ¬
â”œâ”€â”€ Makefile.security            # Makefile å‘½ä»¤é›†
â”œâ”€â”€ semgrep-results.json         # Semgrep æƒæçµæœ
â”œâ”€â”€ security-fix-report.md       # ä¿®å¾©å ±å‘Š
â””â”€â”€ backups/                     # å‚™ä»½æª”æ¡ˆç›®éŒ„
```

## ğŸ”„ GitHub Actions è‡ªå‹•åŒ–

### æ‰‹å‹•è§¸ç™¼
åœ¨ GitHub å°ˆæ¡ˆé é¢ï¼Œé€²å…¥ Actions æ¨™ç±¤ï¼Œé¸æ“‡ "å®‰å…¨å•é¡Œè‡ªå‹•ä¿®å¾©" å·¥ä½œæµç¨‹ï¼Œé»æ“Š "Run workflow" æŒ‰éˆ•ã€‚

### è‡ªå‹•æ’ç¨‹
å·¥ä½œæµç¨‹æœƒæ¯é€±ä¸€å‡Œæ™¨ 2 é»è‡ªå‹•åŸ·è¡Œï¼Œä¸¦åœ¨ç™¼ç¾å•é¡Œæ™‚å»ºç«‹ Pull Requestã€‚

### è¼¸å…¥åƒæ•¸
- `fix_nginx`: æ˜¯å¦ä¿®å¾© Nginx é…ç½®å•é¡Œ (é è¨­: true)
- `fix_dockerfile`: æ˜¯å¦ä¿®å¾© Dockerfile å•é¡Œ (é è¨­: true)
- `fix_terraform`: æ˜¯å¦ä¿®å¾© Terraform å•é¡Œ (é è¨­: true)
- `create_pr`: æ˜¯å¦å»ºç«‹ Pull Request (é è¨­: true)

## ğŸ“Š ä½¿ç”¨ç¯„ä¾‹

### æŸ¥çœ‹ç•¶å‰å®‰å…¨å•é¡Œ
```bash
make -f Makefile.security security-summary
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
ğŸ“Š å®‰å…¨å•é¡Œæ‘˜è¦ï¼š
ç¸½å•é¡Œæ•¸é‡: 79
Nginx å•é¡Œ: 15
Dockerfile å•é¡Œ: 3
Terraform å•é¡Œ: 61
```

### åŸ·è¡Œè‡ªå‹•ä¿®å¾©
```bash
make -f Makefile.security security-fix
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
ğŸ” é–‹å§‹åˆ†æ Semgrep çµæœ...
ç™¼ç¾ 79 å€‹å•é¡Œ
âœ… ä¿®å¾©äº† 15 å€‹ Nginx é…ç½®å•é¡Œ
âœ… ä¿®å¾©äº† 3 å€‹ Dockerfile å•é¡Œ
âœ… ä¿®å¾©äº† 45 å€‹ Terraform å•é¡Œ

ğŸ‰ ç¸½å…±ä¿®å¾©äº† 63 å€‹å®‰å…¨å•é¡Œ
ğŸ“„ ä¿®å¾©å ±å‘Šå·²ç”Ÿæˆ: security-fix-report.md
```

### é©—è­‰ä¿®å¾©æ•ˆæœ
```bash
make -f Makefile.security security-verify
```

è¼¸å‡ºç¯„ä¾‹ï¼š
```
ğŸ” é©—è­‰ä¿®å¾©æ•ˆæœ...
ä¿®å¾©å‰å•é¡Œæ•¸é‡: 79
ä¿®å¾©å¾Œå•é¡Œæ•¸é‡: 16
âœ… æˆåŠŸä¿®å¾©äº† 63 å€‹å®‰å…¨å•é¡Œ
```

## âš ï¸ æ³¨æ„äº‹é …

### é‡è¦æé†’
1. **å‚™ä»½ä¿è­·**: æ‰€æœ‰åŸå§‹æª”æ¡ˆéƒ½æœƒè‡ªå‹•å‚™ä»½åˆ° `backups/` ç›®éŒ„
2. **æ¸¬è©¦ç’°å¢ƒ**: å»ºè­°å…ˆåœ¨æ¸¬è©¦ç’°å¢ƒä¸­é©—è­‰ä¿®å¾©æ•ˆæœ
3. **æ‰‹å‹•å¯©æŸ¥**: è‡ªå‹•ä¿®å¾©å¾Œè«‹æ‰‹å‹•å¯©æŸ¥æ‰€æœ‰è®Šæ›´
4. **è³‡æºé…ç½®**: æŸäº› Terraform ä¿®å¾©å¯èƒ½éœ€è¦é¡å¤–çš„ AWS è³‡æº

### é™åˆ¶
- åªèƒ½ä¿®å¾©å¸¸è¦‹çš„ã€å¯è‡ªå‹•åŒ–çš„å®‰å…¨å•é¡Œ
- è¤‡é›œçš„æ¥­å‹™é‚è¼¯å•é¡Œéœ€è¦æ‰‹å‹•è™•ç†
- æŸäº›ä¿®å¾©å¯èƒ½éœ€è¦é¡å¤–çš„é…ç½®æˆ–è³‡æº

## ğŸ”§ é€²éšä½¿ç”¨

### è‡ªå®šç¾©ä¿®å¾©è¦å‰‡
å¯ä»¥ä¿®æ”¹ `scripts/security_auto_fix.py` ä¾†æ·»åŠ è‡ªå®šç¾©çš„ä¿®å¾©è¦å‰‡ï¼š

```python
def fix_custom_issues(self) -> int:
    """ä¿®å¾©è‡ªå®šç¾©å•é¡Œ"""
    fixes = 0
    # æ·»åŠ è‡ªå®šç¾©ä¿®å¾©é‚è¼¯
    return fixes
```

### æ•´åˆåˆ° CI/CD
åœ¨ `.github/workflows/ci.yml` ä¸­æ·»åŠ å®‰å…¨æª¢æŸ¥ï¼š

```yaml
- name: å®‰å…¨æª¢æŸ¥
  run: |
    make -f Makefile.security security-scan
    make -f Makefile.security security-summary
```

### å®šæœŸåŸ·è¡Œ
è¨­å®š cron ä»»å‹™å®šæœŸåŸ·è¡Œå®‰å…¨æª¢æŸ¥ï¼š

```bash
# æ¯é€±åŸ·è¡Œä¸€æ¬¡å®‰å…¨æª¢æŸ¥
0 2 * * 1 cd /path/to/project && make -f Makefile.security security-full
```

## ğŸ“ æ”¯æ´

å¦‚æœé‡åˆ°å•é¡Œæˆ–æœ‰å»ºè­°ï¼Œè«‹ï¼š

1. æª¢æŸ¥ `security-fix-report.md` ä¸­çš„è©³ç´°å ±å‘Š
2. æŸ¥çœ‹ `backups/` ç›®éŒ„ä¸­çš„åŸå§‹æª”æ¡ˆ
3. é‡æ–°åŸ·è¡Œæƒæé©—è­‰ä¿®å¾©æ•ˆæœ
4. æäº¤ Issue æˆ– Pull Request

## ğŸ“„ æˆæ¬Š

æœ¬å·¥å…·éµå¾ª MIT æˆæ¬Šæ¢æ¬¾ã€‚
